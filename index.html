<!-- Webcam video -->
<video id="video" width="640" height="480" autoplay style="position:absolute; z-index:1;"></video>

<!-- Canvas overlay -->
<canvas id="overlay" width="640" height="480" style="position:absolute; left:0; top:0; z-index:2;"></canvas>

<!-- Target button -->
<button id="targetBtn" style="position:absolute; left:500px; top:200px; z-index:3; width:100px; height:50px;">Click Me</button>

<!-- Audio Player for demo -->
<audio id="audioPlayer" controls style="position:absolute; top:550px;">
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<!-- Mediapipe FaceMesh -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('overlay');
const ctx = canvas.getContext('2d');
const btn = document.getElementById('targetBtn');
let holdTimeout = null;

// Setup webcam
async function setupCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
}

// Initialize FaceMesh
const faceMesh = new FaceMesh({locateFile: (file) => {
    return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
}});
faceMesh.setOptions({
    maxNumFaces: 1,
    refineLandmarks: true,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
});

// Draw dot on nose
let dot = {x: 0, y: 0};
faceMesh.onResults(results => {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0){
        const landmarks = results.multiFaceLandmarks[0];
        const nose = landmarks[1]; // nose tip landmark
        dot.x = nose.x * canvas.width;
        dot.y = nose.y * canvas.height;

        // Draw dot
        ctx.beginPath();
        ctx.arc(dot.x, dot.y, 10, 0, 2*Math.PI);
        ctx.fillStyle = 'red';
        ctx.fill();

        // Check if dot over button
        const btnRect = btn.getBoundingClientRect();
        const canvasRect = canvas.getBoundingClientRect();
        const dotScreenX = canvasRect.left + dot.x;
        const dotScreenY = canvasRect.top + dot.y;

        if(dotScreenX > btnRect.left && dotScreenX < btnRect.right &&
           dotScreenY > btnRect.top && dotScreenY < btnRect.bottom){
               if(!holdTimeout){
                   holdTimeout = setTimeout(()=>{
                       btn.click();
                       console.log('Button clicked via face dot!');
                       holdTimeout = null;
                   },4000); // 4 second hold
               }
        } else {
            if(holdTimeout){
                clearTimeout(holdTimeout);
                holdTimeout = null;
            }
        }
    }
});

// Start camera
setupCamera().then(()=>{
    const camera = new Camera(video,{
        onFrame: async()=>{ await faceMesh.send({image: video}); },
        width:640, height:480
    });
    camera.start();
});
</script>
